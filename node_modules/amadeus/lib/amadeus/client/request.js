'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _qs = require('qs');

var _qs2 = _interopRequireDefault(_qs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * A Request object containing all the compiled information about this request.
 *
 * @property {string} host the host used for this API call
 * @property {number} port the port for this API call. Standard set to 443.
 * @property {boolean} ssl wether this API call uses SSL
 * @property {string} scheme the scheme inferred from the SSL state
 * @property {string} verb the HTTP method, for example `GET` or `POST`
 * @property {string} path the full path of the API endpoint
 * @property {Object} params the parameters to pass in the query or body
 * @property {string} queryPath the path and query string used for the API call
 * @property {string} bearerToken the authentication token
 * @property {string} clientVersion the version of the Amadeus library
 * @property {string} languageVersion the version of Node used
 * @property {string} appId the custom ID of the application using this library
 * @property {string} appVersion the custom version of the application
 *  using this library
 * @property {Object} headers the request headers
 *
 * @param {Object} options
 */
var Request = function () {
  function Request(options) {
    _classCallCheck(this, Request);

    this.host = options.host;
    this.port = options.port;
    this.ssl = options.ssl;
    this.scheme = this.ssl ? 'https' : 'http';
    this.verb = options.verb;
    this.path = options.path;
    this.params = options.params;
    this.queryPath = this.fullQueryPath();
    this.bearerToken = options.bearerToken;
    this.clientVersion = options.clientVersion;
    this.languageVersion = options.languageVersion.replace('v', '');
    this.appId = options.appId;
    this.appVersion = options.appVersion;
    this.headers = {
      'User-Agent': this.userAgent(),
      'Accept': 'application/json, application/vnd.amadeus+json'
    };
    this.addAuthorizationHeader();
    this.addContentTypeHeader();
  }

  // PROTECTED

  /**
   * Compiles the options for the HTTP request.
   *
   * Used by Client.execute when executing this request against the server.
   *
   * @return {Object} an associative array of options to be passed into the
   *  Client.execute function
   * @protected
   */


  _createClass(Request, [{
    key: 'options',
    value: function options() {
      var options = {
        'host': this.host,
        'port': this.port,
        'protocol': `${this.scheme}:`,
        'path': this.queryPath,
        'method': this.verb,
        'headers': this.headers
      };
      return options;
    }

    /**
     * Creats the body for the API cal, serializing the params if the verb is POST.
     *
     * @return {string} the serialized params
     * @protected
     */

  }, {
    key: 'body',
    value: function body() {
      if (this.verb !== 'POST') {
        return '';
      } else {
        return _qs2.default.stringify(this.params);
      }
    }

    // PRIVATE

    /**
     * Build up the custom User Agent
     *
     * @return {string} a user agent in the format "library/version language/version app/version"
     * @private
     */

  }, {
    key: 'userAgent',
    value: function userAgent() {
      var userAgent = `amadeus-node/${this.clientVersion} node/${this.languageVersion}`;
      if (!this.appId) {
        return userAgent;
      }
      return `${userAgent} ${this.appId}/${this.appVersion}`;
    }

    /**
     * Build the full query path, combining the path with the query params if the
     * verb is 'GET'. For example: '/foo/bar?baz=qux'
     *
     * @return {string} the path and params combined into one string.
     * @private
     */

  }, {
    key: 'fullQueryPath',
    value: function fullQueryPath() {
      if (this.verb === 'POST') {
        return this.path;
      } else {
        return `${this.path}?${_qs2.default.stringify(this.params)}`;
      }
    }

    /**
     * Adds an Authorization header if the BearerToken is present
     *
     * @private
     */

  }, {
    key: 'addAuthorizationHeader',
    value: function addAuthorizationHeader() {
      if (!this.bearerToken) {
        return;
      }
      this.headers['Authorization'] = `Bearer ${this.bearerToken}`;
    }

    /**
     * Adds an Content-Type header if the HTTP method equals POST
     *
     * @private
     */

  }, {
    key: 'addContentTypeHeader',
    value: function addContentTypeHeader() {
      if (this.verb !== 'POST') {
        return;
      }
      this.headers['Content-Type'] = 'application/x-www-form-urlencoded';
    }
  }]);

  return Request;
}();

exports.default = Request;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hbWFkZXVzL2NsaWVudC9yZXF1ZXN0LmpzIl0sIm5hbWVzIjpbIlJlcXVlc3QiLCJvcHRpb25zIiwiaG9zdCIsInBvcnQiLCJzc2wiLCJzY2hlbWUiLCJ2ZXJiIiwicGF0aCIsInBhcmFtcyIsInF1ZXJ5UGF0aCIsImZ1bGxRdWVyeVBhdGgiLCJiZWFyZXJUb2tlbiIsImNsaWVudFZlcnNpb24iLCJsYW5ndWFnZVZlcnNpb24iLCJyZXBsYWNlIiwiYXBwSWQiLCJhcHBWZXJzaW9uIiwiaGVhZGVycyIsInVzZXJBZ2VudCIsImFkZEF1dGhvcml6YXRpb25IZWFkZXIiLCJhZGRDb250ZW50VHlwZUhlYWRlciIsInN0cmluZ2lmeSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7Ozs7Ozs7QUFFQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBcUJNQSxPO0FBQ0osbUJBQVlDLE9BQVosRUFBcUI7QUFBQTs7QUFDbkIsU0FBS0MsSUFBTCxHQUF1QkQsUUFBUUMsSUFBL0I7QUFDQSxTQUFLQyxJQUFMLEdBQXVCRixRQUFRRSxJQUEvQjtBQUNBLFNBQUtDLEdBQUwsR0FBdUJILFFBQVFHLEdBQS9CO0FBQ0EsU0FBS0MsTUFBTCxHQUF1QixLQUFLRCxHQUFMLEdBQVcsT0FBWCxHQUFxQixNQUE1QztBQUNBLFNBQUtFLElBQUwsR0FBdUJMLFFBQVFLLElBQS9CO0FBQ0EsU0FBS0MsSUFBTCxHQUF1Qk4sUUFBUU0sSUFBL0I7QUFDQSxTQUFLQyxNQUFMLEdBQXVCUCxRQUFRTyxNQUEvQjtBQUNBLFNBQUtDLFNBQUwsR0FBdUIsS0FBS0MsYUFBTCxFQUF2QjtBQUNBLFNBQUtDLFdBQUwsR0FBdUJWLFFBQVFVLFdBQS9CO0FBQ0EsU0FBS0MsYUFBTCxHQUF1QlgsUUFBUVcsYUFBL0I7QUFDQSxTQUFLQyxlQUFMLEdBQXVCWixRQUFRWSxlQUFSLENBQXdCQyxPQUF4QixDQUFnQyxHQUFoQyxFQUFxQyxFQUFyQyxDQUF2QjtBQUNBLFNBQUtDLEtBQUwsR0FBdUJkLFFBQVFjLEtBQS9CO0FBQ0EsU0FBS0MsVUFBTCxHQUF1QmYsUUFBUWUsVUFBL0I7QUFDQSxTQUFLQyxPQUFMLEdBQXVCO0FBQ3JCLG9CQUFlLEtBQUtDLFNBQUwsRUFETTtBQUVyQixnQkFBVztBQUZVLEtBQXZCO0FBSUEsU0FBS0Msc0JBQUw7QUFDQSxTQUFLQyxvQkFBTDtBQUNEOztBQUVEOztBQUVBOzs7Ozs7Ozs7Ozs7OzhCQVNVO0FBQ1IsVUFBSW5CLFVBQVU7QUFDWixnQkFBUyxLQUFLQyxJQURGO0FBRVosZ0JBQVMsS0FBS0MsSUFGRjtBQUdaLG9CQUFjLEdBQUUsS0FBS0UsTUFBTyxHQUhoQjtBQUlaLGdCQUFTLEtBQUtJLFNBSkY7QUFLWixrQkFBVyxLQUFLSCxJQUxKO0FBTVosbUJBQVksS0FBS1c7QUFOTCxPQUFkO0FBUUEsYUFBT2hCLE9BQVA7QUFDRDs7QUFFRDs7Ozs7Ozs7OzJCQU1PO0FBQ0wsVUFBSSxLQUFLSyxJQUFMLEtBQWMsTUFBbEIsRUFBMEI7QUFBRSxlQUFPLEVBQVA7QUFBWSxPQUF4QyxNQUNLO0FBQUUsZUFBTyxhQUFHZSxTQUFILENBQWEsS0FBS2IsTUFBbEIsQ0FBUDtBQUFtQztBQUMzQzs7QUFFRDs7QUFFQTs7Ozs7Ozs7O2dDQU1ZO0FBQ1YsVUFBSVUsWUFBYSxnQkFBZSxLQUFLTixhQUFjLFNBQVEsS0FBS0MsZUFBZ0IsRUFBaEY7QUFDQSxVQUFJLENBQUMsS0FBS0UsS0FBVixFQUFpQjtBQUFFLGVBQU9HLFNBQVA7QUFBbUI7QUFDdEMsYUFBUSxHQUFFQSxTQUFVLElBQUcsS0FBS0gsS0FBTSxJQUFHLEtBQUtDLFVBQVcsRUFBckQ7QUFDRDs7QUFFRDs7Ozs7Ozs7OztvQ0FPZ0I7QUFDZCxVQUFJLEtBQUtWLElBQUwsS0FBYyxNQUFsQixFQUEwQjtBQUFFLGVBQU8sS0FBS0MsSUFBWjtBQUFtQixPQUEvQyxNQUNLO0FBQUUsZUFBUSxHQUFFLEtBQUtBLElBQUssSUFBRyxhQUFHYyxTQUFILENBQWEsS0FBS2IsTUFBbEIsQ0FBMEIsRUFBakQ7QUFBcUQ7QUFDN0Q7O0FBRUQ7Ozs7Ozs7OzZDQUt5QjtBQUN2QixVQUFJLENBQUMsS0FBS0csV0FBVixFQUF1QjtBQUFFO0FBQVM7QUFDbEMsV0FBS00sT0FBTCxDQUFhLGVBQWIsSUFBaUMsVUFBUyxLQUFLTixXQUFZLEVBQTNEO0FBQ0Q7O0FBRUQ7Ozs7Ozs7OzJDQUt1QjtBQUNyQixVQUFJLEtBQUtMLElBQUwsS0FBYyxNQUFsQixFQUEwQjtBQUFFO0FBQVM7QUFDckMsV0FBS1csT0FBTCxDQUFhLGNBQWIsSUFBK0IsbUNBQS9CO0FBQ0Q7Ozs7OztrQkFHWWpCLE8iLCJmaWxlIjoicmVxdWVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBxcyBmcm9tICdxcyc7XG5cbi8qKlxuICogQSBSZXF1ZXN0IG9iamVjdCBjb250YWluaW5nIGFsbCB0aGUgY29tcGlsZWQgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyByZXF1ZXN0LlxuICpcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBob3N0IHRoZSBob3N0IHVzZWQgZm9yIHRoaXMgQVBJIGNhbGxcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBwb3J0IHRoZSBwb3J0IGZvciB0aGlzIEFQSSBjYWxsLiBTdGFuZGFyZCBzZXQgdG8gNDQzLlxuICogQHByb3BlcnR5IHtib29sZWFufSBzc2wgd2V0aGVyIHRoaXMgQVBJIGNhbGwgdXNlcyBTU0xcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzY2hlbWUgdGhlIHNjaGVtZSBpbmZlcnJlZCBmcm9tIHRoZSBTU0wgc3RhdGVcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB2ZXJiIHRoZSBIVFRQIG1ldGhvZCwgZm9yIGV4YW1wbGUgYEdFVGAgb3IgYFBPU1RgXG4gKiBAcHJvcGVydHkge3N0cmluZ30gcGF0aCB0aGUgZnVsbCBwYXRoIG9mIHRoZSBBUEkgZW5kcG9pbnRcbiAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBwYXJhbXMgdGhlIHBhcmFtZXRlcnMgdG8gcGFzcyBpbiB0aGUgcXVlcnkgb3IgYm9keVxuICogQHByb3BlcnR5IHtzdHJpbmd9IHF1ZXJ5UGF0aCB0aGUgcGF0aCBhbmQgcXVlcnkgc3RyaW5nIHVzZWQgZm9yIHRoZSBBUEkgY2FsbFxuICogQHByb3BlcnR5IHtzdHJpbmd9IGJlYXJlclRva2VuIHRoZSBhdXRoZW50aWNhdGlvbiB0b2tlblxuICogQHByb3BlcnR5IHtzdHJpbmd9IGNsaWVudFZlcnNpb24gdGhlIHZlcnNpb24gb2YgdGhlIEFtYWRldXMgbGlicmFyeVxuICogQHByb3BlcnR5IHtzdHJpbmd9IGxhbmd1YWdlVmVyc2lvbiB0aGUgdmVyc2lvbiBvZiBOb2RlIHVzZWRcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhcHBJZCB0aGUgY3VzdG9tIElEIG9mIHRoZSBhcHBsaWNhdGlvbiB1c2luZyB0aGlzIGxpYnJhcnlcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBhcHBWZXJzaW9uIHRoZSBjdXN0b20gdmVyc2lvbiBvZiB0aGUgYXBwbGljYXRpb25cbiAqICB1c2luZyB0aGlzIGxpYnJhcnlcbiAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBoZWFkZXJzIHRoZSByZXF1ZXN0IGhlYWRlcnNcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICovXG5jbGFzcyBSZXF1ZXN0IHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMuaG9zdCAgICAgICAgICAgID0gb3B0aW9ucy5ob3N0O1xuICAgIHRoaXMucG9ydCAgICAgICAgICAgID0gb3B0aW9ucy5wb3J0O1xuICAgIHRoaXMuc3NsICAgICAgICAgICAgID0gb3B0aW9ucy5zc2w7XG4gICAgdGhpcy5zY2hlbWUgICAgICAgICAgPSB0aGlzLnNzbCA/ICdodHRwcycgOiAnaHR0cCc7XG4gICAgdGhpcy52ZXJiICAgICAgICAgICAgPSBvcHRpb25zLnZlcmI7XG4gICAgdGhpcy5wYXRoICAgICAgICAgICAgPSBvcHRpb25zLnBhdGg7XG4gICAgdGhpcy5wYXJhbXMgICAgICAgICAgPSBvcHRpb25zLnBhcmFtcztcbiAgICB0aGlzLnF1ZXJ5UGF0aCAgICAgICA9IHRoaXMuZnVsbFF1ZXJ5UGF0aCgpO1xuICAgIHRoaXMuYmVhcmVyVG9rZW4gICAgID0gb3B0aW9ucy5iZWFyZXJUb2tlbjtcbiAgICB0aGlzLmNsaWVudFZlcnNpb24gICA9IG9wdGlvbnMuY2xpZW50VmVyc2lvbjtcbiAgICB0aGlzLmxhbmd1YWdlVmVyc2lvbiA9IG9wdGlvbnMubGFuZ3VhZ2VWZXJzaW9uLnJlcGxhY2UoJ3YnLCAnJyk7XG4gICAgdGhpcy5hcHBJZCAgICAgICAgICAgPSBvcHRpb25zLmFwcElkO1xuICAgIHRoaXMuYXBwVmVyc2lvbiAgICAgID0gb3B0aW9ucy5hcHBWZXJzaW9uO1xuICAgIHRoaXMuaGVhZGVycyAgICAgICAgID0ge1xuICAgICAgJ1VzZXItQWdlbnQnIDogdGhpcy51c2VyQWdlbnQoKSxcbiAgICAgICdBY2NlcHQnIDogJ2FwcGxpY2F0aW9uL2pzb24sIGFwcGxpY2F0aW9uL3ZuZC5hbWFkZXVzK2pzb24nXG4gICAgfTtcbiAgICB0aGlzLmFkZEF1dGhvcml6YXRpb25IZWFkZXIoKTtcbiAgICB0aGlzLmFkZENvbnRlbnRUeXBlSGVhZGVyKCk7XG4gIH1cblxuICAvLyBQUk9URUNURURcblxuICAvKipcbiAgICogQ29tcGlsZXMgdGhlIG9wdGlvbnMgZm9yIHRoZSBIVFRQIHJlcXVlc3QuXG4gICAqXG4gICAqIFVzZWQgYnkgQ2xpZW50LmV4ZWN1dGUgd2hlbiBleGVjdXRpbmcgdGhpcyByZXF1ZXN0IGFnYWluc3QgdGhlIHNlcnZlci5cbiAgICpcbiAgICogQHJldHVybiB7T2JqZWN0fSBhbiBhc3NvY2lhdGl2ZSBhcnJheSBvZiBvcHRpb25zIHRvIGJlIHBhc3NlZCBpbnRvIHRoZVxuICAgKiAgQ2xpZW50LmV4ZWN1dGUgZnVuY3Rpb25cbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgb3B0aW9ucygpIHtcbiAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgICdob3N0JyA6IHRoaXMuaG9zdCxcbiAgICAgICdwb3J0JyA6IHRoaXMucG9ydCxcbiAgICAgICdwcm90b2NvbCcgOiBgJHt0aGlzLnNjaGVtZX06YCxcbiAgICAgICdwYXRoJyA6IHRoaXMucXVlcnlQYXRoLFxuICAgICAgJ21ldGhvZCcgOiB0aGlzLnZlcmIsXG4gICAgICAnaGVhZGVycycgOiB0aGlzLmhlYWRlcnNcbiAgICB9O1xuICAgIHJldHVybiBvcHRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0cyB0aGUgYm9keSBmb3IgdGhlIEFQSSBjYWwsIHNlcmlhbGl6aW5nIHRoZSBwYXJhbXMgaWYgdGhlIHZlcmIgaXMgUE9TVC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSB0aGUgc2VyaWFsaXplZCBwYXJhbXNcbiAgICogQHByb3RlY3RlZFxuICAgKi9cbiAgYm9keSgpIHtcbiAgICBpZiAodGhpcy52ZXJiICE9PSAnUE9TVCcpIHsgcmV0dXJuICcnOyB9XG4gICAgZWxzZSB7IHJldHVybiBxcy5zdHJpbmdpZnkodGhpcy5wYXJhbXMpOyB9XG4gIH1cblxuICAvLyBQUklWQVRFXG5cbiAgLyoqXG4gICAqIEJ1aWxkIHVwIHRoZSBjdXN0b20gVXNlciBBZ2VudFxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IGEgdXNlciBhZ2VudCBpbiB0aGUgZm9ybWF0IFwibGlicmFyeS92ZXJzaW9uIGxhbmd1YWdlL3ZlcnNpb24gYXBwL3ZlcnNpb25cIlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdXNlckFnZW50KCkge1xuICAgIGxldCB1c2VyQWdlbnQgPSBgYW1hZGV1cy1ub2RlLyR7dGhpcy5jbGllbnRWZXJzaW9ufSBub2RlLyR7dGhpcy5sYW5ndWFnZVZlcnNpb259YDtcbiAgICBpZiAoIXRoaXMuYXBwSWQpIHsgcmV0dXJuIHVzZXJBZ2VudDsgfVxuICAgIHJldHVybiBgJHt1c2VyQWdlbnR9ICR7dGhpcy5hcHBJZH0vJHt0aGlzLmFwcFZlcnNpb259YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZCB0aGUgZnVsbCBxdWVyeSBwYXRoLCBjb21iaW5pbmcgdGhlIHBhdGggd2l0aCB0aGUgcXVlcnkgcGFyYW1zIGlmIHRoZVxuICAgKiB2ZXJiIGlzICdHRVQnLiBGb3IgZXhhbXBsZTogJy9mb28vYmFyP2Jhej1xdXgnXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gdGhlIHBhdGggYW5kIHBhcmFtcyBjb21iaW5lZCBpbnRvIG9uZSBzdHJpbmcuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBmdWxsUXVlcnlQYXRoKCkge1xuICAgIGlmICh0aGlzLnZlcmIgPT09ICdQT1NUJykgeyByZXR1cm4gdGhpcy5wYXRoOyB9XG4gICAgZWxzZSB7IHJldHVybiBgJHt0aGlzLnBhdGh9PyR7cXMuc3RyaW5naWZ5KHRoaXMucGFyYW1zKX1gOyB9XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhbiBBdXRob3JpemF0aW9uIGhlYWRlciBpZiB0aGUgQmVhcmVyVG9rZW4gaXMgcHJlc2VudFxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgYWRkQXV0aG9yaXphdGlvbkhlYWRlcigpIHtcbiAgICBpZiAoIXRoaXMuYmVhcmVyVG9rZW4pIHsgcmV0dXJuOyB9XG4gICAgdGhpcy5oZWFkZXJzWydBdXRob3JpemF0aW9uJ10gPSBgQmVhcmVyICR7dGhpcy5iZWFyZXJUb2tlbn1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYW4gQ29udGVudC1UeXBlIGhlYWRlciBpZiB0aGUgSFRUUCBtZXRob2QgZXF1YWxzIFBPU1RcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGFkZENvbnRlbnRUeXBlSGVhZGVyKCkge1xuICAgIGlmICh0aGlzLnZlcmIgIT09ICdQT1NUJykgeyByZXR1cm47IH1cbiAgICB0aGlzLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmVxdWVzdDtcbiJdfQ==